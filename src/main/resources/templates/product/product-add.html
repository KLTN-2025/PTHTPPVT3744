<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin-layout}">
<head>
    <title>Th√™m M·ªõi S·∫£n Ph·∫©m</title>
</head>

<body>
<h1 layout:fragment="page-title">üë§ Th√™m kh√°ch h√†ng m·ªõi</h1>
<ol class="breadcrumb float-sm-right" layout:fragment="breadcrumb">
    <li class="breadcrumb-item"><a href="/admin/dashboard">Home</a></li>
    <li class="breadcrumb-item"><a href="/admin/customers">Kh√°ch h√†ng</a></li>
    <li class="breadcrumb-item active">Th√™m m·ªõi</li>
</ol>

<section layout:fragment="content">
    <div class="container-fluid">
        <!-- Alert th√¥ng b√°o l·ªói -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle mr-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>

        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title mb-0">
                    <i class="fas fa-user-plus"></i> Th√¥ng tin kh√°ch h√†ng m·ªõi
                </h3>
            </div>

            <div class="card-body">
                <form th:action="@{/admin/customers/add}" th:object="${customer}" method="post">

                    <!-- Th√¥ng tin c∆° b·∫£n -->
                    <h5 class="border-bottom pb-2 mb-3">
                        <i class="fas fa-user-circle text-primary"></i> Th√¥ng tin c∆° b·∫£n
                    </h5>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label>H·ªç t√™n <span class="text-danger">*</span></label>
                            <input type="text" th:field="*{fullName}" class="form-control"
                                   placeholder="Nh·∫≠p h·ªç v√† t√™n ƒë·∫ßy ƒë·ªß" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Email <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                </div>
                                <input type="email" th:field="*{email}" class="form-control"
                                       placeholder="example@email.com" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label>S·ªë ƒëi·ªán tho·∫°i <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                </div>
                                <input type="text" th:field="*{phone}" class="form-control"
                                       placeholder="0123456789" required pattern="[0-9]{10,11}">
                            </div>
                            <small class="form-text text-muted">Nh·∫≠p 10-11 ch·ªØ s·ªë</small>
                        </div>
                        <div class="form-group col-md-6">
                            <label>ƒê·ªãa ch·ªâ</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                </div>
                                <input type="text" th:field="*{address}" class="form-control"
                                       placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label>Ng√†y sinh</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
                                </div>
                                <input type="date" th:field="*{dateOfBirth}" class="form-control">
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Gi·ªõi t√≠nh</label>
                            <select th:field="*{gender}" class="form-control">
                                <option value="">-- Ch·ªçn gi·ªõi t√≠nh --</option>
                                <option value="MALE">Nam</option>
                                <option value="FEMALE">N·ªØ</option>
                                <option value="OTHER">Kh√°c</option>
                            </select>
                        </div>
                    </div>

                    <!-- Th√¥ng tin t√†i kho·∫£n -->
                    <h5 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-key text-primary"></i> Th√¥ng tin t√†i kho·∫£n
                    </h5>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label>T√™n ƒëƒÉng nh·∫≠p <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                                </div>
                                <input type="text" th:field="*{username}" class="form-control"
                                       placeholder="T√™n ƒëƒÉng nh·∫≠p" required minlength="4">
                            </div>
                            <small class="form-text text-muted">T·ªëi thi·ªÉu 4 k√Ω t·ª±</small>
                        </div>
                        <div class="form-group col-md-6">
                            <label>M·∫≠t kh·∫©u <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                </div>
                                <input type="password" id="passwordField" name="password" class="form-control"
                                       placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required minlength="6">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                        <i class="fas fa-eye" id="toggleIcon"></i>
                                    </button>
                                </div>
                            </div>
                            <small class="form-text text-muted">T·ªëi thi·ªÉu 6 k√Ω t·ª±</small>
                        </div>
                    </div>

                    <!-- Ph√¢n lo·∫°i kh√°ch h√†ng -->
                    <h5 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-crown text-primary"></i> Ph√¢n lo·∫°i kh√°ch h√†ng
                    </h5>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label>C·∫•p b·∫≠c (Tier)</label>
                            <select th:field="*{customerTier}" class="form-control">
                                <option value="BRONZE">ü•â Bronze (ƒê·ªìng)</option>
                                <option value="SILVER">ü•à Silver (B·∫°c)</option>
                                <option value="GOLD">ü•á Gold (V√†ng)</option>
                                <option value="PLATINUM">üíé Platinum (B·∫°ch kim)</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Tr·∫°ng th√°i</label>
                            <select th:field="*{status}" class="form-control">
                                <option value="ACTIVE">‚úÖ Ho·∫°t ƒë·ªông</option>
                                <option value="INACTIVE">‚è∏Ô∏è T·∫°m ng∆∞ng</option>
                                <option value="BLOCKED">üö´ ƒê√£ kh√≥a</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label>ƒêi·ªÉm t√≠ch l≈©y</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-coins"></i></span>
                                </div>
                                <input type="number" th:field="*{loyaltyPoints}" class="form-control"
                                       placeholder="0" min="0" value="0">
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <label>M√£ gi·ªõi thi·ªáu (Referral Code)</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-tag"></i></span>
                                </div>
                                <input type="text" th:field="*{referralCode}" class="form-control"
                                       placeholder="T·ª± ƒë·ªông t·∫°o n·∫øu b·ªè tr·ªëng" readonly>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="generateRefCode">
                                        <i class="fas fa-sync-alt"></i> T·∫°o m·ªõi
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- X√°c th·ª±c -->
                    <h5 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-shield-alt text-primary"></i> X√°c th·ª±c t√†i kho·∫£n
                    </h5>

                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" th:field="*{emailVerified}" class="custom-control-input" id="emailVerified">
                                <label class="custom-control-label" for="emailVerified">
                                    <i class="fas fa-envelope-open-text text-success"></i> Email ƒë√£ x√°c th·ª±c
                                </label>
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" th:field="*{phoneVerified}" class="custom-control-input" id="phoneVerified">
                                <label class="custom-control-label" for="phoneVerified">
                                    <i class="fas fa-phone-square text-success"></i> S·ªë ƒëi·ªán tho·∫°i ƒë√£ x√°c th·ª±c
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                        <a href="/admin/customers" class="btn btn-secondary">
                            <i class="fas fa-arrow-left mr-1"></i> Quay l·∫°i
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save mr-1"></i> L∆∞u kh√°ch h√†ng
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<th:block layout:fragment="scripts">
    <script>
        // Toggle password visibility
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordField = document.getElementById('passwordField');
            const toggleIcon = document.getElementById('toggleIcon');

            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        });

        // Generate referral code
        document.getElementById('generateRefCode').addEventListener('click', function() {
            const refCodeField = document.querySelector('input[name="referralCode"]');
            const randomCode = 'REF' + Math.floor(Math.random() * 1000000);
            refCodeField.value = randomCode;
        });

        // Auto-generate username from email
        const emailField = document.querySelector('input[name="email"]');
        const usernameField = document.querySelector('input[name="username"]');

        emailField.addEventListener('blur', function() {
            if (!usernameField.value) {
                const emailPrefix = this.value.split('@')[0];
                usernameField.value = emailPrefix;
            }
        });

        // Form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
</th:block>
</body>
</html>