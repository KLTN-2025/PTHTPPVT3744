<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${title}">Thiết bị y tế</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f8f9fa;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Breadcrumb */
    .breadcrumb-section {
      background: white;
      padding: 20px 0;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 30px;
    }

    .breadcrumb {
      list-style: none;
      display: flex;
      gap: 10px;
      font-size: 14px;
    }

    .breadcrumb li:not(:last-child)::after {
      content: '/';
      margin-left: 10px;
      color: #999;
    }

    .breadcrumb a {
      color: #0066cc;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    /* Page Header */
    .page-header {
      background: white;
      padding: 30px 0;
      margin-bottom: 30px;
    }

    .page-header h1 {
      font-size: 32px;
      color: #333;
      margin-bottom: 10px;
    }

    .page-header p {
      color: #666;
      font-size: 16px;
    }

    /* Main Content */
    .content-wrapper {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 30px;
      margin-bottom: 50px;
    }

    /* Sidebar Filters */
    .sidebar {
      background: white;
      padding: 20px;
      border-radius: 10px;
      height: fit-content;
    }

    .filter-group {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .filter-group:last-child {
      border-bottom: none;
    }

    .filter-group h3 {
      font-size: 16px;
      margin-bottom: 15px;
      color: #333;
      font-weight: 600;
    }

    .filter-option {
      margin-bottom: 10px;
    }

    .filter-option input[type="checkbox"],
    .filter-option input[type="radio"] {
      margin-right: 8px;
    }

    .filter-option label {
      cursor: pointer;
      font-size: 14px;
      color: #666;
    }

    .filter-option label:hover {
      color: #0066cc;
    }

    .sort-select {
      width: 100%;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
    }

    /* Products Section */
    .products-section {
      background: white;
      padding: 20px;
      border-radius: 10px;
    }

    .products-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .products-header p {
      color: #666;
      font-size: 14px;
    }

    .sort-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .sort-wrapper label {
      font-size: 14px;
      color: #666;
    }

    .sort-wrapper select {
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Product Grid */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .product-card {
      background: #f9f9f9;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #e0e0e0;
      transition: all 0.3s;
    }

    .product-card:hover {
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      transform: translateY(-3px);
      border-color: #0066cc;
    }

    .product-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff4444;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: bold;
    }

    .product-image {
      width: 100%;
      height: 180px;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: #ccc;
      position: relative;
      overflow: hidden;
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-info {
      padding: 15px;
    }

    .product-brand {
      font-size: 12px;
      color: #0066cc;
      font-weight: 500;
      margin-bottom: 5px;
    }

    .product-name {
      font-size: 14px;
      color: #333;
      margin-bottom: 8px;
      height: 36px;
      overflow: hidden;
      line-height: 1.3;
      font-weight: 600;
    }

    .product-name a {
      color: #333;
      text-decoration: none;
    }

    .product-name a:hover {
      color: #0066cc;
    }

    .product-price-group {
      margin-bottom: 10px;
    }

    .product-price {
      font-size: 18px;
      color: #ff4444;
      font-weight: bold;
    }

    .product-original-price {
      font-size: 12px;
      color: #999;
      text-decoration: line-through;
      margin-left: 8px;
    }

    .product-stock {
      font-size: 12px;
      color: #4CAF50;
      margin-bottom: 10px;
    }

    .btn-add-cart {
      width: 100%;
      padding: 8px;
      background: #0066cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: background 0.3s;
    }

    .btn-add-cart:hover {
      background: #0052a3;
    }

    .btn-add-cart:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
      margin-top: 30px;
    }

    .pagination a,
    .pagination span {
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      text-decoration: none;
      color: #333;
      cursor: pointer;
    }

    .pagination a:hover {
      background: #0066cc;
      color: white;
      border-color: #0066cc;
    }

    .pagination .active {
      background: #0066cc;
      color: white;
      border-color: #0066cc;
    }

    .pagination .disabled {
      color: #999;
      cursor: not-allowed;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state i {
      font-size: 64px;
      color: #ccc;
      margin-bottom: 20px;
    }

    .empty-state h3 {
      font-size: 24px;
      color: #666;
      margin-bottom: 10px;
    }

    .empty-state p {
      color: #999;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .content-wrapper {
        grid-template-columns: 1fr;
      }

      .sidebar {
        display: none;
      }

      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }

      .products-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
    }
  </style>
</head>
<body>
<!-- Include Header (từ home.html) -->
<div th:insert="~{frontend-fragments/header :: header}"></div>

<!-- Breadcrumb -->
<div class="breadcrumb-section">
  <div class="container">
    <ul class="breadcrumb">
      <li><a th:href="@{/}"><i class="fas fa-home"></i> Trang chủ</a></li>
      <li><span>Thiết bị y tế</span></li>
    </ul>
  </div>
</div>

<!-- Page Header -->
<div class="page-header">
  <div class="container">
    <h1>Thiết bị y tế</h1>
    <p>Cung cấp đầy đủ thiết bị y tế chất lượng cao cho bệnh viện, phòng khám và gia đình</p>
  </div>
</div>

<!-- Main Content -->
<div class="container">
  <div class="content-wrapper">
    <!-- Sidebar Filters -->
    <div class="sidebar">
      <form th:action="@{/products}" method="get" id="filterForm">
        <!-- Search -->
        <div class="filter-group">
          <h3>Tìm kiếm</h3>
          <input type="text" name="keyword" placeholder="Nhập từ khóa..."
                 th:value="${keyword}" style="width: 100%; padding: 8px; border: 1px solid #e0e0e0; border-radius: 5px;">
        </div>

        <!-- Category Filter -->
        <div class="filter-group">
          <h3>Danh mục</h3>
          <div th:each="category : ${categories}" class="filter-option">
            <input type="radio" th:id="'cat-' + ${category.categoryId}"
                   name="categoryId" th:value="${category.categoryId}"
                   th:checked="${selectedCategoryId == category.categoryId}">
            <label th:for="'cat-' + ${category.categoryId}" th:text="${category.name}">Category</label>
          </div>
          <div class="filter-option">
            <input type="radio" id="cat-all" name="categoryId" value="">
            <label for="cat-all">Tất cả</label>
          </div>
        </div>

        <!-- Brand Filter -->
        <div class="filter-group">
          <h3>Thương hiệu</h3>
          <div th:each="brand : ${brands}" class="filter-option">
            <input type="checkbox" th:id="'brand-' + ${brand.brandId}"
                   name="brandId" th:value="${brand.brandId}"
                   th:checked="${selectedBrandId == brand.brandId}">
            <label th:for="'brand-' + ${brand.brandId}" th:text="${brand.name}">Brand</label>
          </div>
        </div>

        <!-- Sort -->
        <div class="filter-group">
          <h3>Sắp xếp</h3>
          <select name="sortBy" class="sort-select" onchange="document.getElementById('filterForm').submit()">
            <option value="newest" th:selected="${sortBy == 'newest'}">Mới nhất</option>
            <option value="price-asc" th:selected="${sortBy == 'price-asc'}">Giá: Thấp đến cao</option>
            <option value="price-desc" th:selected="${sortBy == 'price-desc'}">Giá: Cao đến thấp</option>
            <option value="popular" th:selected="${sortBy == 'popular'}">Phổ biến</option>
            <option value="sold" th:selected="${sortBy == 'sold'}">Bán chạy</option>
          </select>
        </div>

        <button type="submit" style="width: 100%; padding: 10px; background: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">
          <i class="fas fa-search"></i> Tìm kiếm
        </button>
      </form>
    </div>

    <!-- Products -->
    <div class="products-section">
      <!-- Products Header -->
      <div class="products-header">
        <p>Tìm thấy <strong th:text="${totalProducts}">0</strong> sản phẩm</p>
        <div class="sort-wrapper">
          <label>Sắp xếp:</label>
          <form method="get" th:action="@{/products}" style="display: inline; margin: 0;">
            <!-- Giữ lại các filter hiện tại -->
            <input type="hidden" name="keyword" th:value="${keyword}">
            <input type="hidden" name="categoryId" th:value="${selectedCategoryId}">
            <input type="hidden" name="brandId" th:value="${selectedBrandId}">
            <input type="hidden" name="page" value="1">

            <select name="sortBy" class="sort-select" onchange="this.form.submit()">
              <option value="newest" th:selected="${sortBy == 'newest'}">Mới nhất</option>
              <option value="price-asc" th:selected="${sortBy == 'price-asc'}">Giá: Thấp đến cao</option>
              <option value="price-desc" th:selected="${sortBy == 'price-desc'}">Giá: Cao đến thấp</option>
              <option value="popular" th:selected="${sortBy == 'popular'}">Phổ biến</option>
              <option value="sold" th:selected="${sortBy == 'sold'}">Bán chạy</option>
            </select>
          </form>
        </div>
      </div>

      <!-- Product Grid -->
      <div th:if="${!#lists.isEmpty(products)}">
        <div class="product-grid">
          <div class="product-card" th:each="product : ${products}">
            <div th:if="${product.discountPercent != null && product.discountPercent > 0}"
                 class="product-badge">
              -<span th:text="${product.discountPercent}">0</span>%
            </div>

            <div class="product-image">
              <img th:if="${product.imageUrl}" th:src="${product.imageUrl}" th:alt="${product.name}">
              <i th:unless="${product.imageUrl}" class="fas fa-heartbeat"></i>
            </div>

            <div class="product-info">
              <div class="product-brand" th:if="${product.brand}" th:text="${product.brand.name}">Brand</div>
              <h4 class="product-name">
                <a th:href="@{/products/{id}(id=${product.deviceId})}" th:text="${product.name}">Product</a>
              </h4>

              <div class="product-price-group">
                                <span class="product-price"
                                      th:text="${@helper.formatPrice(@helper.calculateDiscountPrice(product.price.doubleValue(), product.discountPercent.doubleValue()))}">
                                    0 đ
                                </span>
                <span class="product-original-price"
                      th:if="${product.discountPercent != null && product.discountPercent > 0}"
                      th:text="${@helper.formatPrice(product.price.doubleValue())}">
                                    0 đ
                                </span>
              </div>

              <div class="product-stock">
                <i class="fas fa-box"></i>
                <span th:text="${product.status == 'Còn_hàng' ? 'Còn hàng' : 'Hết hàng'}">Còn hàng</span>
              </div>

              <button class="btn-add-cart"
                      th:attr="data-id=${product.deviceId},
                                             data-name=${product.name},
                                             data-price=${@helper.calculateDiscountPrice(product.price.doubleValue(), product.discountPercent.doubleValue())}"
                      th:disabled="${product.status != 'Còn_hàng'}">
                <i class="fas fa-cart-plus"></i> Thêm vào giỏ
              </button>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination" th:if="${totalPages > 1}">
          <a th:if="${currentPage > 1}"
             th:href="@{/products(page=1, keyword=${keyword}, categoryId=${selectedCategoryId}, brandId=${selectedBrandId}, sortBy=${sortBy})}"
             class="first"><i class="fas fa-step-backward"></i></a>
          <a th:if="${currentPage > 1}"
             th:href="@{/products(page=${currentPage - 1}, keyword=${keyword}, categoryId=${selectedCategoryId}, brandId=${selectedBrandId}, sortBy=${sortBy})}"
             class="prev"><i class="fas fa-chevron-left"></i></a>

          <span th:each="i : ${#numbers.sequence(1, totalPages)}"
                th:if="${(i - currentPage) <= 2 and (i - currentPage) >= -2 or i == 1 or i == totalPages}">
                        <span th:if="${i == currentPage}" class="active" th:text="${i}">1</span>
                        <a th:unless="${i == currentPage}"
                           th:href="@{/products(page=${i}, keyword=${keyword}, categoryId=${selectedCategoryId}, brandId=${selectedBrandId}, sortBy=${sortBy})}"
                           th:text="${i}">1</a>
                    </span>

          <a th:if="${currentPage < totalPages}"
             th:href="@{/products(page=${currentPage + 1}, keyword=${keyword}, categoryId=${selectedCategoryId}, brandId=${selectedBrandId}, sortBy=${sortBy})}"
             class="next"><i class="fas fa-chevron-right"></i></a>
          <a th:if="${currentPage < totalPages}"
             th:href="@{/products(page=${totalPages}, keyword=${keyword}, categoryId=${selectedCategoryId}, brandId=${selectedBrandId}, sortBy=${sortBy})}"
             class="last"><i class="fas fa-step-forward"></i></a>
        </div>
      </div>

      <!-- Empty State -->
      <div th:if="${#lists.isEmpty(products)}" class="empty-state">
        <i class="fas fa-box-open"></i>
        <h3>Không tìm thấy sản phẩm</h3>
        <p>Vui lòng thử lại với tiêu chí khác</p>
      </div>
    </div>
  </div>
</div>

<!-- Include Footer (từ home.html) -->
<div th:insert="~{frontend-fragments/footer :: footer}"></div>

<script>
  // Add to cart functionality
  document.addEventListener('click', function(e) {
    if (e.target.closest('.btn-add-cart')) {
      const button = e.target.closest('.btn-add-cart');
      if (button.disabled) {
        alert('Sản phẩm hiện đang hết hàng!');
        return;
      }
      const productId = button.dataset.id;
      const productName = button.dataset.name;
      const productPrice = parseFloat(button.dataset.price);

      let cart = JSON.parse(sessionStorage.getItem('cart') || '[]');
      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({id: productId, name: productName, price: productPrice, quantity: 1});
      }

      sessionStorage.setItem('cart', JSON.stringify(cart));
      alert(`Đã thêm "${productName}" vào giỏ hàng!`);
    }
  });
</script>
</body>
</html>